<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B Website - Background Notification</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-messaging.js"></script>
</head>
<body style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh;">
    <h1 id="status">Waiting for Notification...</h1>
    <button id="enableNotificationBtn" style="padding: 10px 20px; font-size: 18px; margin-top: 20px;">Enable Notifications</button>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDAtc-bmRRAIdchAj3diwV3e1312e02a3a",
            authDomain: "doorring-abd1a.firebaseapp.com",
            projectId: "doorring-abd1a",
            storageBucket: "doorring-abd1a.appspot.com",
            messagingSenderId: "135920861263",
            appId: "1:135920861263:web:c32e01aa9f3e1312e02a3a"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const messaging = firebase.messaging();

        // Register service worker and initialize messaging
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js')
                .then((registration) => {
                    console.log('Service Worker registered with scope:', registration.scope);
                    messaging.useServiceWorker(registration);

                    document.getElementById('enableNotificationBtn').addEventListener('click', () => {
                        requestNotificationPermission();
                    });
                })
                .catch((error) => {
                    console.error('Service Worker registration failed:', error);
                });
        }

        function requestNotificationPermission() {
            messaging.requestPermission()
                .then(() => {
                    console.log('Notification permission granted.');
                    return messaging.getToken({ vapidKey: 'BDj1xe7CXpoitlZyQCfmGZmwQ1jYiPWp7ZNOurl...' }); // 已替換為你的 VAPID 公開金鑰
                })
                .then((token) => {
                    console.log('FCM Token:', token);
                    document.getElementById('status').innerText = 'Notification Enabled!';
                })
                .catch((error) => {
                    console.error('Error getting FCM token:', error);
                    document.getElementById('status').innerText = 'Error enabling notifications.';
                });

            // Handle foreground messages
            messaging.onMessage((payload) => {
                console.log('Message received in foreground: ', payload);
                alert('Notification: ' + payload.notification.body);
            });
        }
    </script>
</body>
</html>
