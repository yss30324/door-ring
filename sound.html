// Register Service Worker
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js').then((registration) => {
        console.log('Service Worker registered with scope:', registration.scope);
    }).catch((error) => {
        console.error('Service Worker registration failed:', error);
    });
}

// Firebase Listener
firebase.database().ref('signal').on('value', (snapshot) => {
    const data = snapshot.val();
    if (data && data.triggered) {
        showNotification('Doorbell Alert', 'Someone pressed the button!');
        firebase.database().ref('signal').set({ triggered: false }); // Reset the signal
    }
});

// Function to show a notification
function showNotification(title, body) {
    if (Notification.permission === 'granted') {
        navigator.serviceWorker.ready.then((registration) => {
            registration.showNotification(title, {
                body: body,
                icon: 'icon.png'
            });
        });
    } else {
        Notification.requestPermission();
    }
}
